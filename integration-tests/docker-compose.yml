version: "3"

volumes:
  pgdata_test:
  conf_test:
  tnastm2_test:

services:
  db:
    command: postgres --log_statement=all
    restart: always
    command: postgres
    image: mdillon/postgis:9.6
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - pgdata_test:/var/lib/postgresql/data
    ports:
      - "5432"

  tnast:
    build: ../
    environment:
      PGUSER: postgres
      PGPASSWORD: postgres
      PGHOST: db
    volumes:
      - tnastm2_test:/root/.m2
      - "./scripts:/scripts"
      - "./data:/data"
      - "./conf:/app/conf"
    ports:
      - "8080"
    links:
      - db

  pyresttest:
    build: ./api-tests/
    environment:
      TNAST_HOST: "tnast:8080"
    volumes:
      - "./api-tests:/api-tests"
      - "./scripts:/scripts"
      - "./data:/data"
    links:
      - tnast
      - db      


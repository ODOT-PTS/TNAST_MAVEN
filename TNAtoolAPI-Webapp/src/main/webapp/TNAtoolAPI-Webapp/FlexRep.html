<html>
<head>
<meta charset="utf-8" />
<title>Connected Networks Summary Report</title>

<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://stuk.github.io/jszip/dist/jszip.js"></script>
<script src="https://stuk.github.io/jszip/vendor/FileSaver.js"></script>
<script
	src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js"
	type="text/javascript"></script>
<script
	src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.ui.position.min.js"
	type="text/javascript"></script>
<script
	src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.1.2/js/dataTables.buttons.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.html5.min.js"></script>
<script
	src="https://cdn.datatables.net/select/1.1.2/js/dataTables.select.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.print.min.js"></script>
<script src="../resources/js/date.js"></script>
<script src="../resources/data/Datasources.js"></script>
<script src="../resources/js/jquery-ui.multidatespicker.js"></script>
<script src="../resources/js/JSMethods.js"></script>

<link rel="stylesheet" type="text/css"
	href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css"
	href="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.css" />
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/buttons/1.1.2/css/buttons.dataTables.min.css" />
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/select/1.1.2/css/select.dataTables.min.css" />
<link rel="stylesheet" type="text/css"
	href="../resources/css/report.css" />

<script type="text/javascript">
var areas = [];
var agencies = [];
var dates = [];
var areaType;
var reportType;
var metrics =[];
var year;
var minUrbanPop = 0;
var maxUrbanPop = 2000000;
var filterOnUrban = false;
var los; // Minimum level of service
var sradius; // search radius
var rac = window.opener.rac;
var wac = window.opener.wac;

$(document).ready(function(){
	areas = window.opener.areas;
	agencies = window.opener.agencies;
	dates = window.opener.dates;
	areaType = window.opener.areaType;
	reportType = window.opener.reportType;
	metrics = window.opener.metrics;
	filterOnUrban = window.opener.filterOnUrban;
	los =  $("#LoS", window.opener.document).val();
	sradius = $("#Sradius", window.opener.document).val();
	year = $("#yearSel", window.opener.document).val();
	filterOnUrban = window.opener.filterOnUrban;
	wac = window.opener.wac;
	rac = window.opener.rac;
	if (filterOnUrban){
		minUrbanPop = $("#minUrbanPop", window.opener.document).val();
		maxUrbanPop = $("#maxUrbanPop", window.opener.document).val();
		}else{
		minUrbanPop = 0;
		maxUrbanPop = 2000000;
	}
	if (reportType == 1){
		$.ajax({
			type: 'GET',
			datatype: 'json',
			url: '/TNAtoolAPI-Webapp/queries/transit/flexRepPop?dbindex=3&agencies='+agencies+'&year='+year+'&dates='+dates+'&areas='+ areas+'&los='+los+'&sradius='+sradius*1609.3+'&areaType='+areaType+'&username='+getSession()+'&minUrbanPop='+minUrbanPop+'&maxUrbanPop='+maxUrbanPop,
			async: false,
			success: function(d){
				html = '<table id="RT" class="display" align="center">';
				tmp = '<tr><th class="metric" title="Identification number reported in the transit agency GTFS feed." id="aid">Agency ID</th>'+
				'<th class="metric" title="Agency name reported in the transit agency GTFS feed." id="an">Agency Name</th>'+
				'<th class="metric" title=".">Area ID</th>'+
				'<th class="metric" title=".">Area Name</th>'+
				'<th class="metric" title=".">Population Type</th>'+
				'<th class="metric" title=".">Pop. Served</th>'+
				'<th class="metric" title=".">Pop. Served by Service</th>'+
				'<th class="metric" title=".">Pop. Serve at Level of Service</th></tr>';
				html += '<thead>'+tmp+'</thead><tbody>';
				$.each(d, function(i,item){
					html += '<tr><td>' + item.agencyId + '</td>'
					+ '<td>' + item.agencyName + '</td>'
					+ '<td>' + item.areaId + '</td>'
					+ '<td>' + item.areaName + '</td>';
					if (item.popType == 'U')
						html += '<td>Urban</td>';
					else
						html += '<td>Rural</td>';
						
					html += '<td>' + numWithCommas(item.popServed) + '</td>'
					+ '<td>' + numWithCommas(item.popSS) + '</td>'
					+ '<td>' + numWithCommas(item.popLOS) + '</td></tr>';
					
				});
				html += '</tbody></table>'
				$('#displayReport').append($(html));
				table = buildDatatables();
			}
		});
	}else if (reportType == 2){
		$.ajax({
			type: 'GET',
			datatype: 'json',
			url: '/TNAtoolAPI-Webapp/queries/transit/flexRepEmp?dbindex=3&agencies='+agencies+'&year='+year+'&dates='+dates+'&areas='+ areas+'&los='+los+'&sradius='+sradius*1609.3+'&areaType='+areaType+'&username='+getSession()+'&minUrbanPop='+minUrbanPop+'&maxUrbanPop='+maxUrbanPop+'&wac='+wac+'&rac='+rac+'&metrics='+metrics.values,
			async: false,
			success: function(d){
				html = '<table id="RT" class="display" align="center">';
				tmp = '<tr><th class="metric" title="Identification number reported in the transit agency GTFS feed." id="aid">Agency ID</th>'+
				'<th class="metric" title="Agency name reported in the transit agency GTFS feed." id="an">Agency Name</th>'+
				'<th class="metric" title=".">Area ID</th>'+
				'<th class="metric" title=".">Area Name</th>';
				
				$.each(metrics.values,function(index,item){
					if (wac){
						tmp += '<th class="metric" title="Summation of unduplicated employees living within an X-mile radius (i.e., stop distance) of all stops within the given geographic area.">' + item + ' Served (WAC)</th>'
						+ '<th class="metric" title="Summation of unduplicated employees living within an X-mile radius stops of all stops in the given area times service stops.">' + item + ' SS (WAC)</th>'
						+ '<th class="metric" title="Summation of unduplicated employees living within an X-mile radius (i.e., stop distance) of all stops within the given geographic area that receive a specified minimum level of service.">' + item + ' LOS (WAC)</th>';
					}
					if (rac){
						tmp += '<th class="metric" title="Summation of unduplicated employees working within an X-mile radius (i.e., stop distance) of all stops within the given geographic area.">' + item + ' Served (RAC)</th>'
						+ '<th class="metric" title="Summation of unduplicated employees working within an X-mile radius stops of all stops in the given area times service stops.">' + item + ' SS (RAC)</th>'
						+ '<th class="metric" title="Summation of unduplicated employees working within an X-mile radius (i.e., stop distance) of all stops within the given geographic area that receive a specified minimum level of service.">' + item + ' LOS (RAC)</th>';
						
					}
				});
				html += '<thead>'+tmp+'</thead><tbody>';
				$.each(d, function(i,item){
					html += '<tr><td>' + item.agencyId + '</td>'
					+ '<td>' + item.agencyName + '</td>'
					+ '<td>' + item.areaId + '</td>'
					+ '<td>' + item.areaName + '</td>';
					
					$.each(metrics.values,function(j,cat){
						if (wac){						
							html += '<td>' + numWithCommas(item[cat + "_served_wac"]) + '</td>'
							+ '<td>' + numWithCommas(item[cat + "_ss_wac"]) + '</td>'
							+ '<td>' + numWithCommas(item[cat + "_los_wac"]) + '</td>';
						};
						if (rac){						
							html += '<td>' + numWithCommas(item[cat + "_served_rac"]) + '</td>'
							+ '<td>' + numWithCommas(item[cat + "_ss_rac"]) + '</td>'
							+ '<td>' + numWithCommas(item[cat + "_los_rac"]) + '</td>';
						}
					});
					html += '</tr>';
				});
				html += '</tbody></table>';
				$('#displayReport').append($(html));
				table = buildDatatables();
			}
		})	
	}else if (reportType == 3){
		$.ajax({
			type: 'GET',
			datatype: 'json',
			url: '/TNAtoolAPI-Webapp/queries/transit/flexRepT6?dbindex=3&agencies='+agencies+'&dates='+dates+'&areas='+ areas+'&los='+los+'&sradius='+sradius*1609.3+'&areaType='+areaType+'&username='+getSession()+'&minUrbanPop='+minUrbanPop+'&maxUrbanPop='+maxUrbanPop+'&metrics='+metrics.values,
			async: false,
			success: function(d){
				html = '<table id="RT" class="display" align="center">';
				tmp = '<tr><th class="metric" title="Identification number reported in the transit agency GTFS feed." id="aid">Agency ID</th>'+
				'<th class="metric" title="Agency name reported in the transit agency GTFS feed." id="an">Agency Name</th>'+
				'<th class="metric" title=".">Area ID</th>'+
				'<th class="metric" title=".">Area Name</th>';
				
				$.each(metrics.names,function(index,item){
					tmp += '<th class="metric" title="Summation of unduplicated employees living within an X-mile radius (i.e., stop distance) of all stops within the given geographic area.">' + item + ' Served</th>'
					+ '<th class="metric" title="Summation of unduplicated employees living within an X-mile radius stops of all stops in the given area times service stops.">' + item + ' SS</th>'
					+ '<th class="metric" title="Summation of unduplicated employees living within an X-mile radius (i.e., stop distance) of all stops within the given geographic area that receive a specified minimum level of service.">' + item + ' LOS</th>';
				});
				html += '<thead>'+tmp+'</thead><tbody>';
				
				$.each(d, function(i,item){
					html += '<tr><td>' + item.agencyId + '</td>'
					+ '<td>' + item.agencyName + '</td>'
					+ '<td>' + item.areaId + '</td>'
					+ '<td>' + item.areaName + '</td>';
					
					$.each(metrics.values,function(j,cat){
						html += '<td>' + numWithCommas(item[cat + "_served"]) + '</td>'
						+ '<td>' + numWithCommas(item[cat + "_ss"]) + '</td>'
						+ '<td>' + numWithCommas(item[cat + "_los"]) + '</td>';
					});
					html += '</tr>';
				});
				html += '</tbody></table>';
				$('#displayReport').append($(html));
				table = buildDatatables();
			}
		});
	}
});

</script>
</head>
<body>
	<div class="container">
		<div class="headerL">
			<h1>Transit Network Analysis Tool Reports</h1>
		</div>

		<div class="headerR">
			<input type="button" onclick="window.close()" title="Close Report"
				value="Close Report" class="button" />
		</div>
	</div>
	<table id="controls">
		<tr>
			<td id="td1">
				<div class="headerBL">
					<h2 style="margin: 0px;"></h2>
				</div>
			</td>

			<td id="td3">
				<div class="headerBR"></div>
			</td>
		</tr>
	</table>


	<p id="displayReport">
		<br>
	</p>
	<br>
	<br>
	<div id="progressbar" style="width: 40%; margin-left: 27%">
		<div class="progress-label"></div>
	</div>
</body>
</html>